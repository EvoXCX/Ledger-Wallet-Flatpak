id: com.Ledger.LedgerWallet
runtime: org.freedesktop.Platform
runtime-version: "25.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node20
command: ledger-wallet-wrapper.sh
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=all
  - --share=network
  - --persist=ledger
  - --talk-name=org.freedesktop.Notifications
  - --system-talk-name=org.freedesktop.login1
  - --system-talk-name=org.freedesktop.UDisks2

modules:
  #####################################################################
  # 1) Zypak
  #####################################################################
  - name: zypak
    sources:
      - type: git
        url: https://github.com/refi64/zypak
        tag: 'v2025.09'

  #####################################################################
  # 2) Ledger Wallet (Node 20 + pnpm)
  #####################################################################
  - name: ledger-wallet
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/LedgerHQ/ledger-live.git
        tag: '@ledgerhq/live-desktop@2.133.0'
      - type: file
        url: https://github.com/pnpm/pnpm/releases/download/v10.23.0/pnpm-linux-x64
        dest-filename: pnpm
        sha256: 6e5f25fad67ba1b4fe1050c8992ced33ce8689245a834ddec149940a20c2be5c
      - type: file
        path: ledger-wallet-wrapper.sh
      - type: file
        path: com.Ledger.LedgerWallet.png
      - type: file
        path: com.Ledger.LedgerWallet.desktop
    build-options:
      append-path: /usr/lib/sdk/node20/bin:/run/build/ledger-live/bin
      build-args:
        - --share=network
    build-commands:
      # ledger-wallet-wrapper.sh
      - install -Dm755 ledger-wallet-wrapper.sh /app/bin/ledger-wallet-wrapper.sh

      # Desktop + icon
      - install -Dm444 com.Ledger.LedgerWallet.png /app/share/icons/hicolor/256x256/apps/com.Ledger.LedgerWallet.png
      - install -Dm444 com.Ledger.LedgerWallet.desktop /app/share/applications/com.Ledger.LedgerWallet.desktop

      # Install pnpm in builder path
      - install -Dm755 pnpm /run/build/ledger-live/bin/pnpm

      # Dependencies
      - pnpm install

      # Build Ledger Wallet Desktop
      - pnpm release:lld
      - cp -r apps/ledger-live-desktop/dist/linux-unpacked/* /app/bin/

      # Clean
      - rm -f /app/bin/LICENSES.chromium.html
      - rm -f /app/bin/LICENSE.electron.txt
      - rm -f /app/bin/chrome-sandbox